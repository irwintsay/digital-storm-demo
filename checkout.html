<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Storm - Checkout</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
</head>
<body>

  <div class="container">
    <a href="/digital-storm-demo/product.html"><- Back to Product Page</a>
    <p>Checkout Page Example</p>
  </div>
  <div class="container" style="width:600px;margin:50px auto 0px auto;">
    <h3>Payment Method</h3>
    <form id="selectPayment">
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input paymentOptions" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="credit-debit" checked="checked"> Credit/Debit Card
        </label>
      </div>
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input paymentOptions" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="bread"> Financing with Bread
        </label>
      </div>
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input paymentOptions" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="check"> Check
        </label>
      </div>
    </form>
  </div>

  <div class="container" style="width:600px;margin:30px auto 50px auto;">
    <h3>Billing Information</h3>
    <form id="billingForm" action="/confirmation.html">
      <div class="form-row">
        <div class="form-group col">
          <label for="billingFirstName">First Name</label>
          <input type="text" class="form-control" id="billingFirstName" placeholder="">
        </div>
        <div class="form-group col">
          <label for="billingLastName">Last Name</label>
          <input type="text" class="form-control" id="billingLastName" placeholder="">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col">
          <label for="billingAddressOne">Address 1</label>
          <input type="text" class="form-control" id="billingAddressOne" placeholder="">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col">
          <label for="billingAddressTwo">Address 2</label>
          <input type="text" class="form-control" id="billingAddressTwo" placeholder="">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col">
          <label for="billingCity">City</label>
          <input type="text" class="form-control" id="billingCity">
        </div>
        <div class="form-group col">
          <label for="billingState">State</label>
          <select type="text" class="form-control" id="billingState">
            <option value=""></option>
            <option value="AK">Alaska</option>
            <option value="AL">Alabama</option>
            <option value="AR">Arkansas</option>
            <option value="AZ">Arizona</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DC">District of Columbia</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="IA">Iowa</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="MA">Massachusetts</option>
            <option value="MD">Maryland</option>
            <option value="ME">Maine</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MO">Missouri</option>
            <option value="MS">Mississippi</option>
            <option value="MT">Montana</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="NE">Nebraska</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NV">Nevada</option>
            <option value="NY">New York</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="PR">Puerto Rico</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VA">Virginia</option>
            <option value="VT">Vermont</option>
            <option value="WA">Washington</option>
            <option value="WI">Wisconsin</option>
            <option value="WV">West Virginia</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col">
          <label for="billingZipCode">Zip Code</label>
          <input type="text" class="form-control" id="billingZipCode">
        </div>
        <div class="form-group col">
          <label for="billingPhone">Mobile Phone</label>
          <input type="text" class="form-control" id="billingPhone">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col">
          <label for="billingEmail">Email</label>
          <input type="text" class="form-control" id="billingEmail">
        </div>
      </div>

      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>

  <!-- Include Bread.js script -->
  <script src="https://checkout-sandbox.getbread.com/bread.js" data-api-key="c9af398c-de5d-4613-82e0-32105acd2f1b"></script>
  <!-- Create opts object and then attach event listener to Submit button when Bread is selected as Payment method -->
  <script>
    var opts = {
      actAsLabel: false,
      allowCheckout: true,
      asLowAs: true,
      customTotal: 200000,
      customCSS: "#bread-button,body,html{height:100%;margin:0;width:100%}body{display:table}#bread-button{background:#FFF;color:#d83b34;display:table-cell;font-family:Montserrat,sans-serif;font-size:14px;text-align:center;vertical-align:middle}.bread-text{cursor:pointer;transition:border .1s linear}.bread-text:hover{border-bottom:1px solid #d83b34}.bread-amt{font-weight:700}.bread-embed-inner,.bread-label .bread-embed-icon{display:inline-block}.bread-btn .bread-as-low-as:before,.bread-label .bread-as-low-as:before{content:'As low as '}.bread-for:before{content:'Or '}",
      done: function(err, tx_token) {
        if (err) {
          console.error("There was an error: " + err);
          return;
        }
        if (tx_token !== undefined) {
          console.log(tx_token);
          var i = document.createElement('input');
          i.type = 'hidden';
          i.name = 'token';
          i.value = tx_token;
          var f = document.createElement('form');
          f.action = '/confirmation.html';
          f.method = 'get';
          f.appendChild(i);
          document.body.appendChild(f);
          f.submit();
        }
        return;
      }
    };

    var getBillingInfo = function() {
      var billingContact = {};
      billingContact.firstName = document.getElementById('billingFirstName').value;
      billingContact.lastName = document.getElementById('billingLastName').value;
      billingContact.address = document.getElementById('billingAddressOne').value;
      billingContact.address2 = document.getElementById('billingAddressTwo').value;
      billingContact.city = document.getElementById('billingCity').value;
      billingContact.state = document.getElementById('billingState').value;
      billingContact.zip = document.getElementById('billingZipCode').value;
      billingContact.phone = document.getElementById('billingPhone').value;
      billingContact.email = document.getElementById('billingEmail').value;
      return billingContact;
    };

    var submitToBread = function(event) {
      event.preventDefault();
      opts.billingContact = getBillingInfo();

      // Passes opts object to Bread and displays modal
      bread.showCheckout(opts);
    };

    document.getElementById('selectPayment').addEventListener('change', function(e) {
      var selectedPayment = '';
      document.querySelectorAll('.paymentOptions').forEach(function(option) {
        if(option.checked) selectedPayment = option;
      });
      if(selectedPayment.value === 'bread') {
          document.querySelector('#billingForm').addEventListener('submit', submitToBread);
        } else {
          document.querySelector('#billingForm').removeEventListener('submit', submitToBread);
        }
    });

  </script>
</body>
</html>